import{c as ee,o as n,w as q,a as e,l as L,e as l,j as y,f as p,v as _,t as o,F as G,i as X,k as Y,q as de,g as f,n as C,s as x,x as Se,d as F,u as j,y as De,b as M,h as P,m as Ue}from"./app-CzY7Gfd0.js";import{A as Ce}from"./AdminLayout-DY30SRq5.js";import{_ as Ne}from"./FinanceCharts-D1DXhbwS.js";import{_ as ue}from"./Modal-RNVanG8h.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css            */import"./responsive-blanco-DOkwJ8BK.js";const Fe={class:"p-6 space-y-5 text-white"},Me={class:"flex items-center justify-between gap-4"},Pe={key:0,class:"text-red-500 text-sm mt-1"},Te={key:0,class:"text-red-500 text-sm mt-1"},Ee={key:0},Ve={key:1},je=["value"],Ae={key:0,class:"text-red-500 text-sm mt-1"},ze={class:"flex items-center gap-2 mt-6"},Oe={class:"sm:col-span-2"},Be={key:0,class:"text-red-500 text-sm mt-1"},Re={class:"sm:col-span-2 flex justify-end gap-2 mt-2"},Ie=["disabled"],qe={__name:"PaymentModal",props:{show:{type:Boolean,default:!1},form:{type:Object,required:!0},paymentMethodOptions:{type:Array,default:()=>[]},normalizeCurrency:{type:Function,default:null}},emits:["close","submit"],setup(s,{emit:d}){const g=s,b=d,i=()=>{typeof g.normalizeCurrency=="function"&&g.normalizeCurrency()};return(c,a)=>(n(),ee(ue,{show:s.show,onClose:a[10]||(a[10]=r=>b("close"))},{default:q(()=>[e("div",Fe,[e("div",Me,[a[11]||(a[11]=e("div",null,[e("h2",{class:"text-lg font-semibold"},"Registrar pago"),e("p",{class:"text-sm text-gray-400"},"Registra un pago y se convertirá a USD según la tasa.")],-1)),e("button",{type:"button",class:"text-gray-300 hover:text-white",onClick:a[0]||(a[0]=r=>b("close"))}," Cerrar ")]),e("form",{onSubmit:a[9]||(a[9]=L(r=>b("submit"),["prevent"])),class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},[e("div",null,[a[12]||(a[12]=e("label",{class:"text-gray-300 text-sm"},"Fecha",-1)),y(e("input",{"onUpdate:modelValue":a[1]||(a[1]=r=>s.form.payment_date=r),type:"date",class:"fin-input"},null,512),[[_,s.form.payment_date]]),s.form.errors.payment_date?(n(),l("p",Pe,o(s.form.errors.payment_date),1)):p("",!0)]),e("div",null,[a[13]||(a[13]=e("label",{class:"text-gray-300 text-sm"},"Monto",-1)),y(e("input",{"onUpdate:modelValue":a[2]||(a[2]=r=>s.form.amount_original=r),type:"number",step:"0.01",class:"fin-input"},null,512),[[_,s.form.amount_original]]),s.form.errors.amount_original?(n(),l("p",Te,o(s.form.errors.amount_original),1)):p("",!0)]),e("div",null,[a[14]||(a[14]=e("label",{class:"text-gray-300 text-sm"},"Moneda (ISO)",-1)),y(e("input",{"onUpdate:modelValue":a[3]||(a[3]=r=>s.form.currency=r),onBlur:i,type:"text",class:"fin-input",placeholder:"USD / COP / MXN..."},null,544),[[_,s.form.currency]]),a[15]||(a[15]=e("p",{class:"text-gray-500 text-xs mt-1"},"Ej: USD, COP, MXN (3 letras).",-1))]),s.form.currency!=="USD"?(n(),l("div",Ee,[a[16]||(a[16]=e("label",{class:"text-gray-300 text-sm"},"Tasa a USD",-1)),y(e("input",{"onUpdate:modelValue":a[4]||(a[4]=r=>s.form.exchange_rate_to_base=r),type:"number",step:"0.000001",class:"fin-input"},null,512),[[_,s.form.exchange_rate_to_base]]),a[17]||(a[17]=e("p",{class:"text-gray-500 text-xs mt-1"},"Ej: si 1 COP = 0.00025 USD, pon 0.00025",-1))])):(n(),l("div",Ve,[...a[18]||(a[18]=[e("label",{class:"text-gray-300 text-sm"},"Tasa a USD",-1),e("input",{value:1,disabled:"",class:"fin-input opacity-60"},null,-1),e("p",{class:"text-gray-500 text-xs mt-1"},"USD no requiere tasa.",-1)])])),e("div",null,[a[20]||(a[20]=e("label",{class:"text-gray-300 text-sm"},"Método de pago",-1)),y(e("select",{"onUpdate:modelValue":a[5]||(a[5]=r=>s.form.payment_method=r),class:"fin-input"},[a[19]||(a[19]=e("option",{value:"",disabled:""},"Selecciona un método",-1)),(n(!0),l(G,null,X(s.paymentMethodOptions,r=>(n(),l("option",{key:r.value,value:r.value},o(r.label),9,je))),128))],512),[[Y,s.form.payment_method]]),s.form.errors.payment_method?(n(),l("p",Ae,o(s.form.errors.payment_method),1)):p("",!0)]),e("div",ze,[y(e("input",{"onUpdate:modelValue":a[6]||(a[6]=r=>s.form.is_advance=r),type:"checkbox",class:"fin-checkbox"},null,512),[[de,s.form.is_advance]]),a[21]||(a[21]=e("span",{class:"text-gray-300 text-sm"},"¿Es anticipo?",-1))]),e("div",Oe,[a[22]||(a[22]=e("label",{class:"text-gray-300 text-sm"},"Notas",-1)),y(e("textarea",{"onUpdate:modelValue":a[7]||(a[7]=r=>s.form.notes=r),rows:"3",class:"fin-input",placeholder:"Notas adicionales sobre este pago..."},null,512),[[_,s.form.notes]]),s.form.errors.notes?(n(),l("p",Be,o(s.form.errors.notes),1)):p("",!0)]),e("div",Re,[e("button",{type:"button",class:"fin-btn-ghost",onClick:a[8]||(a[8]=r=>b("close"))}," Cancelar "),e("button",{class:"fin-btn-primary",type:"submit",disabled:s.form.processing}," Guardar pago ",8,Ie)])],32)])]),_:1},8,["show"]))}},Le=te(qe,[["__scopeId","data-v-4f82d78b"]]),Ge={class:"p-6 space-y-5 text-white"},Xe={class:"flex items-center justify-between gap-4"},Ye={key:0,class:"text-red-500 text-sm mt-1"},He={key:0,class:"text-red-500 text-sm mt-1"},Je={key:0,class:"text-red-500 text-sm mt-1"},Ke={key:0,class:"text-red-500 text-sm mt-1"},Qe={key:0},We={key:1},Ze={class:"sm:col-span-2"},et={key:0,class:"text-red-500 text-sm mt-1"},tt={class:"sm:col-span-2"},st={key:0,class:"text-red-500 text-sm mt-1"},at={class:"sm:col-span-2 flex justify-end gap-2 mt-2"},ot=["disabled"],nt={__name:"ExpenseModal",props:{show:{type:Boolean,default:!1},form:{type:Object,required:!0},normalizeCurrency:{type:Function,default:null}},emits:["close","submit"],setup(s,{emit:d}){const g=s,b=d,i=()=>{typeof g.normalizeCurrency=="function"&&g.normalizeCurrency()};return(c,a)=>(n(),ee(ue,{show:s.show,onClose:a[11]||(a[11]=r=>b("close"))},{default:q(()=>[e("div",Ge,[e("div",Xe,[a[12]||(a[12]=e("div",null,[e("h2",{class:"text-lg font-semibold"},"Registrar gasto"),e("p",{class:"text-sm text-gray-400"},"Registra un gasto y se convertirá a USD según la tasa.")],-1)),e("button",{type:"button",class:"text-gray-300 hover:text-white",onClick:a[0]||(a[0]=r=>b("close"))}," Cerrar ")]),e("form",{onSubmit:a[10]||(a[10]=L(r=>b("submit"),["prevent"])),class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},[e("div",null,[a[13]||(a[13]=e("label",{class:"text-gray-300 text-sm"},"Fecha",-1)),y(e("input",{"onUpdate:modelValue":a[1]||(a[1]=r=>s.form.expense_date=r),type:"date",class:"fin-input"},null,512),[[_,s.form.expense_date]]),s.form.errors.expense_date?(n(),l("p",Ye,o(s.form.errors.expense_date),1)):p("",!0)]),e("div",null,[a[14]||(a[14]=e("label",{class:"text-gray-300 text-sm"},"Nombre del gasto *",-1)),y(e("input",{"onUpdate:modelValue":a[2]||(a[2]=r=>s.form.name=r),type:"text",class:"fin-input",placeholder:"Ej: Vuelo, Hotel..."},null,512),[[_,s.form.name]]),s.form.errors.name?(n(),l("p",He,o(s.form.errors.name),1)):p("",!0)]),e("div",null,[a[16]||(a[16]=e("label",{class:"text-gray-300 text-sm"},"Categoría",-1)),y(e("select",{"onUpdate:modelValue":a[3]||(a[3]=r=>s.form.category=r),class:"fin-input"},[...a[15]||(a[15]=[e("option",{value:""},"Selecciona una categoría",-1),e("option",{value:"transporte"},"Transporte",-1),e("option",{value:"hospedaje"},"Hospedaje",-1),e("option",{value:"alimentacion"},"Alimentación",-1),e("option",{value:"sonido"},"Sonido",-1),e("option",{value:"iluminacion"},"Iluminación",-1),e("option",{value:"seguridad"},"Seguridad",-1),e("option",{value:"marketing"},"Marketing",-1),e("option",{value:"fotografo"},"Fotógrafo",-1),e("option",{value:"filmmaker"},"Filmmaker",-1),e("option",{value:"visa"},"Visa",-1),e("option",{value:"ropa"},"Ropa",-1),e("option",{value:"impuestos"},"Impuestos",-1),e("option",{value:"otros"},"Otros",-1)])],512),[[Y,s.form.category]]),s.form.errors.category?(n(),l("p",Je,o(s.form.errors.category),1)):p("",!0)]),e("div",null,[a[17]||(a[17]=e("label",{class:"text-gray-300 text-sm"},"Monto",-1)),y(e("input",{"onUpdate:modelValue":a[4]||(a[4]=r=>s.form.amount_original=r),type:"number",step:"0.01",class:"fin-input"},null,512),[[_,s.form.amount_original]]),s.form.errors.amount_original?(n(),l("p",Ke,o(s.form.errors.amount_original),1)):p("",!0)]),e("div",null,[a[18]||(a[18]=e("label",{class:"text-gray-300 text-sm"},"Moneda (ISO)",-1)),y(e("input",{"onUpdate:modelValue":a[5]||(a[5]=r=>s.form.currency=r),onBlur:i,type:"text",class:"fin-input",placeholder:"USD / COP / MXN..."},null,544),[[_,s.form.currency]]),a[19]||(a[19]=e("p",{class:"text-gray-500 text-xs mt-1"},"Ej: USD, COP, MXN (3 letras).",-1))]),s.form.currency!=="USD"?(n(),l("div",Qe,[a[20]||(a[20]=e("label",{class:"text-gray-300 text-sm"},"Tasa a USD",-1)),y(e("input",{"onUpdate:modelValue":a[6]||(a[6]=r=>s.form.exchange_rate_to_base=r),type:"number",step:"0.000001",class:"fin-input"},null,512),[[_,s.form.exchange_rate_to_base]]),a[21]||(a[21]=e("p",{class:"text-gray-500 text-xs mt-1"},"Ej: si 1 COP = 0.00025 USD, pon 0.00025",-1))])):(n(),l("div",We,[...a[22]||(a[22]=[e("label",{class:"text-gray-300 text-sm"},"Tasa a USD",-1),e("input",{value:1,disabled:"",class:"fin-input opacity-60"},null,-1),e("p",{class:"text-gray-500 text-xs mt-1"},"USD no requiere tasa.",-1)])])),e("div",Ze,[a[23]||(a[23]=e("label",{class:"text-gray-300 text-sm"},"Descripción",-1)),y(e("textarea",{"onUpdate:modelValue":a[7]||(a[7]=r=>s.form.description=r),rows:"3",class:"fin-input",placeholder:"Detalles adicionales del gasto..."},null,512),[[_,s.form.description]]),s.form.errors.description?(n(),l("p",et,o(s.form.errors.description),1)):p("",!0)]),e("div",tt,[a[24]||(a[24]=e("label",{class:"text-gray-300 text-sm"},"Comprobante (imagen)",-1)),e("input",{type:"file",accept:"image/*",class:"fin-input",onChange:a[8]||(a[8]=r=>{s.form.receipt_file=r.target.files[0]})},null,32),s.form.errors.receipt_file?(n(),l("p",st,o(s.form.errors.receipt_file),1)):p("",!0)]),e("div",at,[e("button",{type:"button",class:"fin-btn-ghost",onClick:a[9]||(a[9]=r=>b("close"))}," Cancelar "),e("button",{class:"fin-btn-secondary",type:"submit",disabled:s.form.processing}," Guardar gasto ",8,ot)])],32)])]),_:1},8,["show"]))}},lt=te(nt,[["__scopeId","data-v-29b3f190"]]),A=s=>{if(!s)return"—";const d=new Date(s);return Number.isNaN(d.getTime())?s:d.toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"})},rt={class:"bg-[#1d1d1b] border border-[#2a2a2a] rounded-lg p-6"},it={key:0,class:"text-gray-400"},dt={key:1,class:"overflow-x-auto"},ut={class:"min-w-full text-sm text-gray-300"},mt={class:"text-xs uppercase text-gray-400"},ct={key:0,class:"py-2 text-right"},pt={class:"py-2 whitespace-nowrap"},ft={class:"py-2 whitespace-nowrap"},xt={class:"py-2 whitespace-nowrap"},yt={class:"py-2 whitespace-nowrap capitalize"},vt={class:"py-2 whitespace-nowrap"},bt={class:"py-2 max-w-[280px]"},gt={class:"text-gray-300"},wt={key:0,class:"py-2 text-right whitespace-nowrap"},$t=["onClick"],ht={__name:"PaymentsTable",props:{payments:{type:Array,default:()=>[]},canDelete:{type:Boolean,default:!0}},emits:["delete"],setup(s,{emit:d}){const g=d;return(b,i)=>(n(),l("div",rt,[!s.payments||s.payments.length===0?(n(),l("div",it," No hay pagos todavía. ")):(n(),l("div",dt,[e("table",ut,[e("thead",mt,[e("tr",null,[i[0]||(i[0]=e("th",{class:"py-2 text-left"},"Fecha",-1)),i[1]||(i[1]=e("th",{class:"py-2 text-left"},"Original",-1)),i[2]||(i[2]=e("th",{class:"py-2 text-left"},"USD",-1)),i[3]||(i[3]=e("th",{class:"py-2 text-left"},"Método",-1)),i[4]||(i[4]=e("th",{class:"py-2 text-left"},"Anticipo",-1)),i[5]||(i[5]=e("th",{class:"py-2 text-left"},"Notas",-1)),s.canDelete?(n(),l("th",ct,"Acciones")):p("",!0)])]),e("tbody",null,[(n(!0),l(G,null,X(s.payments,c=>(n(),l("tr",{key:c.id,class:"border-t border-[#2a2a2a]"},[e("td",pt,o(f(A)(c.payment_date)),1),e("td",ft,o(c.currency)+" "+o(Number(c.amount_original??0).toFixed(2)),1),e("td",xt," $ "+o(Number(c.amount_base??0).toFixed(2)),1),e("td",yt,o(c.payment_method||"—"),1),e("td",vt,[e("span",{class:C(["px-2 py-1 rounded text-xs",c.is_advance?"bg-[#ffa236]/15 text-[#ffa236] border border-[#ffa236]/30":"bg-[#2a2a2a] text-gray-300"])},o(c.is_advance?"Sí":"No"),3)]),e("td",bt,[e("span",gt,o((c.notes||"").trim()||"—"),1)]),s.canDelete?(n(),l("td",wt,[e("button",{onClick:a=>g("delete",c.id),class:"text-red-400 hover:underline"}," Eliminar ",8,$t)])):p("",!0)]))),128))])])]))]))}},kt={class:"bg-[#1d1d1b] border border-[#2a2a2a] rounded-lg p-6"},_t={key:0,class:"text-gray-400"},St={key:1,class:"overflow-x-auto"},Dt={class:"min-w-full text-sm text-gray-300"},Ut={class:"text-xs uppercase text-gray-400"},Ct={key:0,class:"py-2 text-right"},Nt={class:"py-2 whitespace-nowrap"},Ft={class:"py-2 font-semibold whitespace-nowrap"},Mt={class:"py-2 whitespace-nowrap"},Pt={key:0,class:"bg-[#2a2a2a] text-gray-300 px-2 py-1 rounded text-xs capitalize"},Tt={key:1,class:"text-gray-500"},Et={class:"py-2 whitespace-nowrap"},Vt={class:"py-2 whitespace-nowrap"},jt={class:"py-2 max-w-[280px]"},At={class:"text-gray-300"},zt={class:"py-2 whitespace-nowrap"},Ot=["href"],Bt={key:1,class:"text-gray-500"},Rt={key:0,class:"py-2 text-right whitespace-nowrap"},It=["onClick"],qt={__name:"ExpensesTable",props:{expenses:{type:Array,default:()=>[]},canDelete:{type:Boolean,default:!0}},emits:["delete"],setup(s,{emit:d}){const g=d;return(b,i)=>(n(),l("div",kt,[!s.expenses||s.expenses.length===0?(n(),l("div",_t," No hay gastos registrados. ")):(n(),l("div",St,[e("table",Dt,[e("thead",Ut,[e("tr",null,[i[0]||(i[0]=e("th",{class:"py-2 text-left"},"Fecha",-1)),i[1]||(i[1]=e("th",{class:"py-2 text-left"},"Nombre",-1)),i[2]||(i[2]=e("th",{class:"py-2 text-left"},"Categoría",-1)),i[3]||(i[3]=e("th",{class:"py-2 text-left"},"Original",-1)),i[4]||(i[4]=e("th",{class:"py-2 text-left"},"USD",-1)),i[5]||(i[5]=e("th",{class:"py-2 text-left"},"Descripción",-1)),i[6]||(i[6]=e("th",{class:"py-2 text-left"},"Comprobante",-1)),s.canDelete?(n(),l("th",Ct,"Acciones")):p("",!0)])]),e("tbody",null,[(n(!0),l(G,null,X(s.expenses,c=>(n(),l("tr",{key:c.id,class:"border-t border-[#2a2a2a]"},[e("td",Nt,o(f(A)(c.expense_date)),1),e("td",Ft,o(c.name||"—"),1),e("td",Mt,[c.category?(n(),l("span",Pt,o(c.category),1)):(n(),l("span",Tt,"—"))]),e("td",Et,o(c.currency)+" "+o(Number(c.amount_original??0).toFixed(2)),1),e("td",Vt," $ "+o(Number(c.amount_base??0).toFixed(2)),1),e("td",jt,[e("span",At,o((c.description||"").trim()||"—"),1)]),e("td",zt,[c.receipt_url?(n(),l("a",{key:0,href:c.receipt_url,target:"_blank",rel:"noopener",class:"text-[#ffa236] hover:underline"}," Ver ",8,Ot)):(n(),l("span",Bt,"—"))]),s.canDelete?(n(),l("td",Rt,[e("button",{onClick:a=>g("delete",c.id),class:"text-red-400 hover:underline"}," Eliminar ",8,It)])):p("",!0)]))),128))])])]))]))}},Lt={class:"bg-gradient-to-br from-[#1d1d1b] to-[#151512] border border-[#3a3a38] rounded-xl p-6 flex flex-wrap gap-4 shadow-lg"},Gt={class:"flex-1 min-w-[200px]"},Xt={class:"flex-1 min-w-[200px]"},Yt={class:"flex-1 min-w-[200px]"},Ht={__name:"AnalysisFilters",props:{filterType:{type:String,default:"all"},filterYear:{type:[String,Number,null],default:null},filterMonth:{type:[String,Number,null],default:null},filterDateFrom:{type:[String,null],default:null},filterDateTo:{type:[String,null],default:null}},emits:["update:filterType","update:filterYear","update:filterMonth","update:filterDateFrom","update:filterDateTo"],setup(s,{emit:d}){const g=s,b=d,i=x({get:()=>g.filterType,set:r=>b("update:filterType",r)}),c=x({get:()=>g.filterDateFrom,set:r=>b("update:filterDateFrom",r)}),a=x({get:()=>g.filterDateTo,set:r=>b("update:filterDateTo",r)});return(r,v)=>(n(),l("div",Lt,[e("div",Gt,[v[4]||(v[4]=e("label",{class:"text-[#ffa236] text-sm mb-2 font-semibold"}," Filtrar por estado ",-1)),y(e("select",{"onUpdate:modelValue":v[0]||(v[0]=D=>i.value=D),class:"w-full bg-[#0f0f0d] border border-[#3a3a38] rounded-lg px-3 py-2 text-white text-sm hover:border-[#ffa236]/30 focus:border-[#ffa236] transition-colors"},[...v[3]||(v[3]=[e("option",{value:"all"},"Todos",-1),e("option",{value:"paid"},"Solo pagados",-1),e("option",{value:"pending"},"Solo pendientes",-1)])],512),[[Y,i.value]])]),e("div",Xt,[v[5]||(v[5]=e("label",{class:"text-[#ffa236] text-sm mb-2 font-semibold"},"Desde",-1)),y(e("input",{"onUpdate:modelValue":v[1]||(v[1]=D=>c.value=D),type:"date",class:"w-full bg-[#0f0f0d] border border-[#3a3a38] rounded-lg px-3 py-2 text-white text-sm hover:border-[#ffa236]/30 focus:border-[#ffa236] transition-colors"},null,512),[[_,c.value]])]),e("div",Yt,[v[6]||(v[6]=e("label",{class:"text-[#ffa236] text-sm mb-2 font-semibold"},"Hasta",-1)),y(e("input",{"onUpdate:modelValue":v[2]||(v[2]=D=>a.value=D),type:"date",class:"w-full bg-[#0f0f0d] border border-[#3a3a38] rounded-lg px-3 py-2 text-white text-sm hover:border-[#ffa236]/30 focus:border-[#ffa236] transition-colors"},null,512),[[_,a.value]])])]))}},Jt={class:"space-y-6 text-white"},Kt={class:"flex items-center justify-between gap-4"},Qt={class:"text-2xl font-bold"},Wt={class:"text-gray-400 text-sm mt-2 space-y-1"},Zt={class:"text-white"},es={class:"text-white"},ts={key:0},ss={key:0,class:"block text-gray-400 text-xs"},as={key:1,class:"block text-gray-500 text-xs"},os={key:1},ns={class:"text-white"},ls={key:0,class:"block text-gray-500 text-xs"},rs={class:"flex items-center gap-3"},is={key:0,class:"bg-[#1d1d1b] border border-[#2a2a2a] rounded-lg p-6"},ds={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},us={class:"text-2xl font-semibold text-[#ffa236] mt-2"},ms={class:"text-sm text-gray-300"},cs=["disabled"],ps={key:1,class:"text-green-400 font-semibold"},fs={key:0,class:"block text-xs text-gray-400 mt-1"},xs={class:"font-semibold"},ys={class:"opacity-90 mt-1"},vs={class:"flex flex-wrap gap-2 border-b border-[#2a2a2a] pb-3"},bs={key:2,class:"space-y-6"},gs={class:"grid grid-cols-1 sm:grid-cols-3 gap-4"},ws={class:"card"},$s={class:"text-white text-xl font-semibold"},hs={class:"card"},ks={class:"text-white text-xl font-semibold"},_s={class:"card"},Ss={class:"text-white text-xl font-semibold"},Ds={class:"bg-[#1d1d1b] border border-[#2a2a2a] rounded-lg p-6"},Us={class:"flex items-center justify-between mb-3"},Cs={class:"flex items-center gap-2 text-sm text-gray-300"},Ns=["disabled"],Fs=["disabled"],Ms={key:0,class:"text-amber-300 text-sm mt-3"},Ps={key:1,class:"text-red-500 text-sm mt-2"},Ts={class:"bg-[#1d1d1b] border border-[#2a2a2a] rounded-lg p-6"},Es={class:"flex items-center justify-between mb-4"},Vs=["disabled"],js={key:0,class:"text-red-500 text-sm mt-1"},As={key:1,class:"text-amber-300 text-xs mt-1"},zs={key:0,class:"text-red-500 text-sm mt-1"},Os={key:0,class:"text-red-500 text-sm mt-1"},Bs={class:"sm:col-span-3 flex justify-end"},Rs=["disabled"],Is={key:0,class:"bg-[#1d1d1b] border border-[#2a2a2a] rounded-lg p-6"},qs={class:"space-y-3 text-sm"},Ls={class:"text-white font-semibold"},Gs={class:"text-gray-400 text-xs"},Xs={class:"text-sm"},Ys={key:0,class:"text-green-400 font-semibold"},Hs={class:"block text-xs text-gray-400"},Js={key:1,class:"text-yellow-400 font-semibold"},Ks={class:"bg-[#1d1d1b] border border-[#2a2a2a] rounded-lg p-6"},Qs={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 text-sm"},Ws={class:"mini-card"},Zs={class:"text-white font-semibold"},ea={key:0},ta={key:1},sa={key:0,class:"text-gray-400 text-xs mt-1"},aa={key:1,class:"text-gray-500 text-xs mt-1"},oa={class:"mini-card"},na={class:"text-white font-semibold capitalize"},la={class:"mini-card"},ra={class:"text-white font-semibold"},ia={class:"ml-1"},da={class:"text-white font-semibold"},ua={class:"mini-card"},ma={class:"text-white font-semibold"},ca={class:"text-white font-semibold"},pa={class:"mini-card"},fa={class:"text-white font-semibold"},xa={class:"mini-card"},ya={class:"mt-1 space-y-1"},va={class:"text-white font-semibold"},ba={class:"text-white font-semibold"},ga={key:3,class:"space-y-4"},wa={class:"flex flex-wrap items-center justify-between gap-3 bg-[#1d1d1b] border border-[#2a2a2a] rounded-lg p-5"},$a={class:"text-sm text-gray-400"},ha={key:4,class:"space-y-4"},ka={class:"flex flex-wrap items-center justify-between gap-3 bg-[#1d1d1b] border border-[#2a2a2a] rounded-lg p-5"},_a={class:"text-sm text-gray-400"},Sa={key:5,class:"space-y-6"},Da={__name:"Finance",props:{event:{type:Object,required:!0},finance:{type:Object,default:()=>({})}},setup(s){const d=s,{props:g}=Se(),b=x(()=>{var u,t;return((t=(u=g.auth)==null?void 0:u.user)==null?void 0:t.role_names)||[]}),i=x(()=>b.value.includes("admin")),c=x(()=>b.value.includes("roadmanager")),a=F("resumen"),r=F(!1),v=F(!1),D=F("all"),H=F(null),J=F(null),K=F(null),Q=F(null),me=[{value:"transferencia",label:"Transferencia bancaria"},{value:"efectivo",label:"Efectivo"},{value:"tarjeta",label:"Tarjeta"},{value:"paypal",label:"PayPal"},{value:"otro",label:"Otro"}],w=j({payment_date:new Date().toISOString().slice(0,10),amount_original:"",currency:"USD",exchange_rate_to_base:1,payment_method:"",is_advance:!1,notes:""}),$=j({expense_date:new Date().toISOString().slice(0,10),name:"",description:"",category:"",receipt_file:null,amount_original:"",currency:"USD",exchange_rate_to_base:1}),U=j({is_paid:d.event.is_paid??!1}),k=j({status:d.event.status||"",event_date:d.event.event_date||"",full_payment_due_date:d.event.full_payment_due_date||""}),W=j({confirmed:!0}),Z=x(()=>d.event.road_managers||d.event.roadManagers||[]),ce=x(()=>{var t,h;if(!c.value)return null;const u=(h=(t=g.auth)==null?void 0:t.user)==null?void 0:h.id;return Z.value.find(S=>S.id===u)||null}),z=x(()=>{var u,t;return((t=(u=ce.value)==null?void 0:u.pivot)==null?void 0:t.payment_confirmed_at)||null}),pe=x(()=>{const u=Number(d.event.show_fee_total??0),t=Number(d.event.advance_percentage??0),h=Number.isFinite(t)?t:0,S=Math.min(Math.max(h,0),100),m=u*(1-S/100);return Number.isFinite(m)?m:0});De(i,u=>{u||(a.value="pagos")},{immediate:!0});const N=x(()=>{var S,m,V,ie;const u=Number(((S=d.finance)==null?void 0:S.total_paid_base)??0),t=Number(((m=d.finance)==null?void 0:m.total_expenses_base)??0),h=u-t;return{paid:u,expenses:t,net:h,shareLabel:Number(((V=d.finance)==null?void 0:V.share_label)??h*.3),shareArtist:Number(((ie=d.finance)==null?void 0:ie.share_artist)??h*.7)}}),se=x(()=>{var u;return Number(((u=d.finance)==null?void 0:u.total_paid_base)??0)}),T=x(()=>Number(d.event.show_fee_total??0)),E=x(()=>T.value>0&&se.value>=T.value),fe=x(()=>T.value<=0?0:Math.max(T.value-se.value,0)),O=x(()=>T.value<=0?"Define el fee del show para poder marcarlo como pagado.":E.value?"":`Faltan $${fe.value.toFixed(2)} USD para marcarlo como pagado.`),B=x(()=>(k.status||d.event.status||"").toString().trim().toLowerCase()),R=x(()=>{const u=B.value;if(!u)return{label:"Sin estado",className:"bg-gray-500/20 text-gray-300 border border-gray-500/30"};const t={cotizado:"Cotizado",reservado:"Reservado",confirmado:"Confirmado",pospuesto:"Pospuesto",pagado:"Pagado",cancelado:"Cancelado"},h={cotizado:"bg-gray-500/20 text-gray-200 border border-gray-500/30",reservado:"bg-yellow-500/20 text-yellow-300 border border-yellow-500/30",confirmado:"bg-blue-500/20 text-blue-300 border border-blue-500/30",pospuesto:"bg-orange-500/20 text-orange-300 border border-orange-500/30",pagado:"bg-green-500/20 text-green-300 border border-green-500/30",cancelado:"bg-red-500/20 text-red-300 border border-red-500/30"};return{label:t[u]||u,className:h[u]||"bg-gray-500/20 text-gray-300 border border-gray-500/30"}}),I=x(()=>{const u=B.value;return u==="pospuesto"?{title:"Evento pospuesto",message:"Actualiza la nueva fecha y confirma el plan con el equipo.",className:"bg-orange-500/10 border border-orange-500/30 text-orange-200"}:u==="cancelado"?{title:"Evento cancelado",message:"Revisa pagos y gastos para cerrar la contabilidad.",className:"bg-red-500/10 border border-red-500/30 text-red-200"}:null}),xe=x(()=>{var u,t,h,S;return d.event?[{...d.event,title:d.event.title||d.event.name||"Evento",event_date:d.event.event_date||new Date().toISOString(),status:d.event.is_paid?"pagado":"pendiente",total_paid_base:((u=d.finance)==null?void 0:u.total_paid_base)??0,total_expenses_base:((t=d.finance)==null?void 0:t.total_expenses_base)??0,net_base:(((h=d.finance)==null?void 0:h.total_paid_base)??0)-(((S=d.finance)==null?void 0:S.total_expenses_base)??0)}]:[]}),ae=()=>{const u=(w.currency||"").toUpperCase().trim();w.currency=u||"USD",(w.currency==="USD"||!w.exchange_rate_to_base||Number(w.exchange_rate_to_base)<=0)&&(w.exchange_rate_to_base=1)},oe=()=>{const u=($.currency||"").toUpperCase().trim();$.currency=u||"USD",($.currency==="USD"||!$.exchange_rate_to_base||Number($.exchange_rate_to_base)<=0)&&($.exchange_rate_to_base=1)},ye=()=>{ae(),w.post(route("admin.events.payments.store",d.event.id),{preserveScroll:!0,onSuccess:()=>{w.reset("amount_original","payment_method","is_advance","notes"),r.value=!1,a.value="pagos"}})},ve=u=>{i.value&&confirm("¿Eliminar este pago?")&&w.delete(route("admin.events.payments.destroy",u),{preserveScroll:!0})},be=()=>{oe(),$.post(route("admin.events.expenses.store",d.event.id),{forceFormData:!0,preserveScroll:!0,onSuccess:()=>{$.reset("amount_original","name","description","category","receipt_file"),v.value=!1,a.value="gastos"}})},ge=u=>{i.value&&confirm("¿Eliminar este gasto?")&&$.delete(route("admin.events.expenses.destroy",u),{preserveScroll:!0})},we=()=>{U.patch(route("admin.events.payment-status.update",d.event.id),{preserveScroll:!0})},$e=()=>{k.patch(route("admin.events.details.update",d.event.id),{preserveScroll:!0})},he=()=>{W.processing||z.value||W.patch(route("admin.events.roadmanager-payment.update",d.event.id),{preserveScroll:!0})},ne=x(()=>{const u=!!U.is_paid;return{label:u?"Pagado":"Pendiente",className:u?"bg-green-500/20 text-green-300 border border-green-500/40":"bg-yellow-500/20 text-yellow-300 border border-yellow-500/40"}}),ke=x(()=>!U.is_paid||E.value),_e=x(()=>B.value!=="pagado"||E.value),le=()=>{w.payment_date=new Date().toISOString().slice(0,10),w.currency=(w.currency||"USD").toUpperCase().trim()||"USD",w.currency==="USD"&&(w.exchange_rate_to_base=1),r.value=!0},re=()=>{$.expense_date=new Date().toISOString().slice(0,10),$.currency=($.currency||"USD").toUpperCase().trim()||"USD",$.currency==="USD"&&($.exchange_rate_to_base=1),v.value=!0};return(u,t)=>(n(),ee(Ce,{title:"Finanzas"},{default:q(()=>{var h,S;return[e("div",Jt,[e("div",Kt,[e("div",null,[e("h1",Qt,"Finanzas — "+o(s.event.title),1),e("div",Wt,[e("p",null,[t[15]||(t[15]=P(" Artista principal: ",-1)),e("span",Zt,o(((h=s.event.main_artist)==null?void 0:h.name)||((S=s.event.mainArtist)==null?void 0:S.name)||"—"),1)]),e("p",null,[t[16]||(t[16]=P(" Ubicación: ",-1)),e("span",es,[s.event.city||s.event.country?(n(),l("span",ts,[P(o(s.event.city)+o(s.event.city&&s.event.country?",":"")+" "+o(s.event.country)+" ",1),s.event.location?(n(),l("span",ss,o(s.event.location),1)):p("",!0),s.event.venue_address?(n(),l("span",as,o(s.event.venue_address),1)):p("",!0)])):(n(),l("span",os,[e("span",ns,o(s.event.location||"—"),1),s.event.venue_address?(n(),l("span",ls,o(s.event.venue_address),1)):p("",!0)]))])])])]),e("div",rs,[M(f(Ue),{href:u.route("admin.events.index"),class:"text-[#ffa236] hover:underline"},{default:q(()=>[...t[17]||(t[17]=[P(" ← Volver ",-1)])]),_:1},8,["href"])])]),c.value?(n(),l("div",is,[e("div",ds,[e("div",null,[t[18]||(t[18]=e("h2",{class:"text-lg font-semibold"},"Pago pendiente al road manager",-1)),t[19]||(t[19]=e("p",{class:"text-sm text-gray-400"}," Corresponde al porcentaje restante despues del adelanto. ",-1)),e("p",us,o(s.event.currency||"USD")+" "+o(pe.value.toFixed(2)),1)]),e("div",ms,[z.value?(n(),l("div",ps,[t[20]||(t[20]=P(" Pago confirmado ",-1)),z.value?(n(),l("span",fs,o(f(A)(z.value)),1)):p("",!0)])):(n(),l("button",{key:0,type:"button",class:"btn-primary",disabled:f(W).processing,onClick:he}," Confirmar pago recibido ",8,cs))])])])):p("",!0),I.value?(n(),l("div",{key:1,class:C(["rounded-lg p-4 text-sm",I.value.className])},[e("p",xs,o(I.value.title),1),e("p",ys,o(I.value.message),1)],2)):p("",!0),e("div",vs,[i.value?(n(),l("button",{key:0,type:"button",class:C(["tab-btn",a.value==="resumen"?"tab-btn--active":"tab-btn--idle"]),onClick:t[0]||(t[0]=m=>a.value="resumen")}," Resumen ",2)):p("",!0),e("button",{type:"button",class:C(["tab-btn",a.value==="pagos"?"tab-btn--active":"tab-btn--idle"]),onClick:t[1]||(t[1]=m=>a.value="pagos")}," Pagos ",2),e("button",{type:"button",class:C(["tab-btn",a.value==="gastos"?"tab-btn--active":"tab-btn--idle"]),onClick:t[2]||(t[2]=m=>a.value="gastos")}," Gastos ",2),i.value?(n(),l("button",{key:1,type:"button",class:C(["tab-btn",a.value==="analisis"?"tab-btn--active":"tab-btn--idle"]),onClick:t[3]||(t[3]=m=>a.value="analisis")}," Análisis ",2)):p("",!0),t[21]||(t[21]=e("div",{class:"flex-1"},null,-1)),e("div",{class:"flex gap-2"},[e("button",{type:"button",class:"btn-primary",onClick:le},"+ Nuevo pago"),e("button",{type:"button",class:"btn-secondary",onClick:re},"+ Nuevo gasto")])]),i.value&&a.value==="resumen"?(n(),l("div",bs,[e("div",gs,[e("div",ws,[t[22]||(t[22]=e("p",{class:"text-gray-400 text-sm"},"Total pagado",-1)),e("p",$s,"$ "+o(N.value.paid.toFixed(2)),1),t[23]||(t[23]=e("p",{class:"text-gray-500 text-xs mt-1"},"Suma de pagos (convertidos a USD).",-1))]),e("div",hs,[t[24]||(t[24]=e("p",{class:"text-gray-400 text-sm"},"Total gastos",-1)),e("p",ks,"$ "+o(N.value.expenses.toFixed(2)),1),t[25]||(t[25]=e("p",{class:"text-gray-500 text-xs mt-1"},"Suma de gastos (convertidos a USD).",-1))]),e("div",_s,[t[26]||(t[26]=e("p",{class:"text-gray-400 text-sm"},"Neto",-1)),e("p",Ss,"$ "+o(N.value.net.toFixed(2)),1),t[27]||(t[27]=e("p",{class:"text-gray-500 text-xs mt-1"},"Pagos − gastos.",-1))])]),e("div",Ds,[e("div",Us,[t[28]||(t[28]=e("div",null,[e("h2",{class:"text-lg font-semibold"},"Estado de pago"),e("p",{class:"text-sm text-gray-400"},"Marca si el evento se considera pagado o pendiente.")],-1)),e("span",{class:C(["px-3 py-1 rounded-full text-xs font-semibold",ne.value.className])},o(ne.value.label),3)]),e("form",{onSubmit:L(we,["prevent"]),class:"flex flex-col sm:flex-row sm:items-center gap-4"},[e("label",Cs,[y(e("input",{"onUpdate:modelValue":t[4]||(t[4]=m=>f(U).is_paid=m),type:"checkbox",class:"checkbox",disabled:!E.value&&!f(U).is_paid},null,8,Ns),[[de,f(U).is_paid]]),t[29]||(t[29]=P(" Marcar como pagado ",-1))]),t[30]||(t[30]=e("div",{class:"flex-1"},null,-1)),e("button",{type:"submit",class:"btn-primary self-start sm:self-auto",disabled:f(U).processing||!ke.value},"Guardar estado",8,Fs)],32),O.value?(n(),l("p",Ms,o(O.value),1)):p("",!0),f(U).errors.is_paid?(n(),l("p",Ps,o(f(U).errors.is_paid),1)):p("",!0)]),e("div",Ts,[e("div",Es,[t[31]||(t[31]=e("div",null,[e("h2",{class:"text-lg font-semibold"},"Estado y fechas"),e("p",{class:"text-sm text-gray-400"},"Actualiza el estado del evento y fechas clave.")],-1)),e("span",{class:C(["px-3 py-1 rounded-full text-xs font-semibold border",R.value.className])},o(R.value.label),3)]),e("form",{onSubmit:L($e,["prevent"]),class:"grid grid-cols-1 sm:grid-cols-3 gap-4"},[e("div",null,[t[38]||(t[38]=e("label",{class:"text-gray-300 text-sm"},"Estado",-1)),y(e("select",{"onUpdate:modelValue":t[5]||(t[5]=m=>f(k).status=m),class:"input"},[t[32]||(t[32]=e("option",{value:""},"Selecciona un estado",-1)),t[33]||(t[33]=e("option",{value:"cotizado"},"Cotizado",-1)),t[34]||(t[34]=e("option",{value:"reservado"},"Reservado",-1)),t[35]||(t[35]=e("option",{value:"confirmado"},"Confirmado",-1)),t[36]||(t[36]=e("option",{value:"pospuesto"},"Pospuesto",-1)),e("option",{value:"pagado",disabled:!E.value},"Pagado",8,Vs),t[37]||(t[37]=e("option",{value:"cancelado"},"Cancelado",-1))],512),[[Y,f(k).status]]),f(k).errors.status?(n(),l("p",js,o(f(k).errors.status),1)):B.value==="pagado"&&O.value?(n(),l("p",As,o(O.value),1)):p("",!0)]),e("div",null,[t[39]||(t[39]=e("label",{class:"text-gray-300 text-sm"},"Fecha del evento",-1)),y(e("input",{"onUpdate:modelValue":t[6]||(t[6]=m=>f(k).event_date=m),type:"date",class:"input"},null,512),[[_,f(k).event_date]]),f(k).errors.event_date?(n(),l("p",zs,o(f(k).errors.event_date),1)):p("",!0)]),e("div",null,[t[40]||(t[40]=e("label",{class:"text-gray-300 text-sm"},"Fecha pago final",-1)),y(e("input",{"onUpdate:modelValue":t[7]||(t[7]=m=>f(k).full_payment_due_date=m),type:"date",class:"input"},null,512),[[_,f(k).full_payment_due_date]]),f(k).errors.full_payment_due_date?(n(),l("p",Os,o(f(k).errors.full_payment_due_date),1)):p("",!0)]),e("div",Bs,[e("button",{type:"submit",class:"btn-primary",disabled:f(k).processing||!_e.value}," Guardar cambios ",8,Rs)])],32)]),Z.value.length?(n(),l("div",Is,[t[42]||(t[42]=e("h2",{class:"text-lg font-semibold mb-4"},"Confirmacion road managers",-1)),e("div",qs,[(n(!0),l(G,null,X(Z.value,m=>{var V;return n(),l("div",{key:m.id,class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 border-b border-[#2a2a2a] pb-2"},[e("div",null,[e("p",Ls,o(m.name),1),e("p",Gs,o(m.email),1)]),e("div",Xs,[(V=m.pivot)!=null&&V.payment_confirmed_at?(n(),l("span",Ys,[t[41]||(t[41]=P(" Confirmado ",-1)),e("span",Hs,o(f(A)(m.pivot.payment_confirmed_at)),1)])):(n(),l("span",Js,"Pendiente"))])])}),128))])])):p("",!0),e("div",Ks,[t[52]||(t[52]=e("h2",{class:"text-lg font-semibold mb-4"},"Datos del evento",-1)),e("div",Qs,[e("div",Ws,[t[43]||(t[43]=e("p",{class:"text-gray-400"},"Ubicación",-1)),e("p",Zs,[s.event.city||s.event.country?(n(),l("span",ea,o(s.event.city)+o(s.event.city&&s.event.country?",":"")+" "+o(s.event.country),1)):(n(),l("span",ta,o(s.event.location||"—"),1))]),s.event.location?(n(),l("p",sa,o(s.event.location),1)):p("",!0),s.event.venue_address?(n(),l("p",aa,o(s.event.venue_address),1)):p("",!0)]),e("div",oa,[t[44]||(t[44]=e("p",{class:"text-gray-400"},"Tipo",-1)),e("p",na,o(s.event.event_type||"—"),1),t[45]||(t[45]=e("p",{class:"text-gray-400 mt-2"},"Estado",-1)),e("span",{class:C(["inline-flex px-2 py-1 rounded-full text-xs font-semibold border mt-1",R.value.className])},o(R.value.label),3)]),e("div",la,[t[46]||(t[46]=e("p",{class:"text-gray-400"},"Fee del show",-1)),e("p",ra,[e("span",null,o(s.event.currency||"USD"),1),e("span",ia,o(Number(s.event.show_fee_total??0).toFixed(2)),1)]),t[47]||(t[47]=e("p",{class:"text-gray-400 mt-2"},"Moneda",-1)),e("p",da,o(s.event.currency||"USD"),1)]),e("div",ua,[t[48]||(t[48]=e("p",{class:"text-gray-400"},"% Anticipo",-1)),e("p",ma,o(s.event.advance_percentage??50)+"%",1),t[49]||(t[49]=e("p",{class:"text-gray-400 mt-2"},"¿Se espera anticipo?",-1)),e("p",ca,o(s.event.advance_expected?"Sí":"No"),1)]),e("div",pa,[t[50]||(t[50]=e("p",{class:"text-gray-400"},"Fecha pago final",-1)),e("p",fa,o(s.event.full_payment_due_date?f(A)(s.event.full_payment_due_date):"—"),1)]),e("div",xa,[t[51]||(t[51]=e("p",{class:"text-gray-400"},"Reparto (neto)",-1)),e("div",ya,[e("p",va,"Label: $ "+o(N.value.shareLabel.toFixed(2)),1),e("p",ba,"Artista: $ "+o(N.value.shareArtist.toFixed(2)),1)])])])])])):a.value==="pagos"?(n(),l("div",ga,[e("div",wa,[e("div",null,[t[53]||(t[53]=e("h2",{class:"text-lg font-semibold"},"Pagos",-1)),e("p",$a,"Total: $ "+o(N.value.paid.toFixed(2)),1)]),e("button",{type:"button",class:"btn-primary",onClick:le},"+ Nuevo pago")]),M(ht,{payments:s.event.payments||[],"can-delete":i.value,onDelete:ve},null,8,["payments","can-delete"])])):a.value==="gastos"?(n(),l("div",ha,[e("div",ka,[e("div",null,[t[54]||(t[54]=e("h2",{class:"text-lg font-semibold"},"Gastos",-1)),e("p",_a,"Total: $ "+o(N.value.expenses.toFixed(2)),1)]),e("button",{type:"button",class:"btn-secondary",onClick:re},"+ Nuevo gasto")]),M(qt,{expenses:s.event.expenses||[],"can-delete":i.value,onDelete:ge},null,8,["expenses","can-delete"])])):i.value?(n(),l("div",Sa,[M(Ht,{"filter-type":D.value,"onUpdate:filterType":t[8]||(t[8]=m=>D.value=m),"filter-date-from":K.value,"onUpdate:filterDateFrom":t[9]||(t[9]=m=>K.value=m),"filter-date-to":Q.value,"onUpdate:filterDateTo":t[10]||(t[10]=m=>Q.value=m),"filter-year":H.value,"onUpdate:filterYear":t[11]||(t[11]=m=>H.value=m),"filter-month":J.value,"onUpdate:filterMonth":t[12]||(t[12]=m=>J.value=m)},null,8,["filter-type","filter-date-from","filter-date-to","filter-year","filter-month"]),M(Ne,{totals:N.value,events:xe.value,"filter-type":D.value,"filter-year":H.value,"filter-month":J.value,"filter-date-from":K.value,"filter-date-to":Q.value,currency:"$"},null,8,["totals","events","filter-type","filter-year","filter-month","filter-date-from","filter-date-to"])])):p("",!0),M(Le,{show:r.value,form:f(w),"payment-method-options":me,"normalize-currency":ae,onClose:t[13]||(t[13]=m=>r.value=!1),onSubmit:ye},null,8,["show","form"]),M(lt,{show:v.value,form:f($),"normalize-currency":oe,onClose:t[14]||(t[14]=m=>v.value=!1),onSubmit:be},null,8,["show","form"])])]}),_:1}))}},Ea=te(Da,[["__scopeId","data-v-d5bd7215"]]);export{Ea as default};
