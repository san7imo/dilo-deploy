import{s as K,x as v,d as w,y as C,c as k,w as F,a as e,e as l,f as r,j as N,o as a,F as B,i as L,t as n,k as H,v as V,g as U,m as M,h as z,n as Q,l as X,A as Z}from"./app-DAUalued.js";import{A as tt}from"./AdminLayout-DhfR_T_4.js";import{_ as et}from"./PaginationLinks-djDCdIfn.js";import{f as st}from"./money-kgxah7JU.js";import{_ as ot}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css            */import"./responsive-blanco-DOkwJ8BK.js";const at={class:"flex justify-between items-center mb-6"},nt={class:"flex flex-wrap items-center gap-4"},lt={class:"flex items-center gap-3"},rt=["value"],dt={class:"flex items-center gap-3"},it={key:0,class:"flex items-center gap-2"},ut={key:0,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-6 gap-4 mb-6"},ct={class:"rounded-lg p-4 bg-[#0f0f0f] border border-[#232323]"},pt={class:"text-xl font-semibold text-white"},xt={class:"rounded-lg p-4 bg-[#0f0f0f] border border-[#232323]"},ft={class:"text-xl font-semibold text-emerald-300"},_t={class:"rounded-lg p-4 bg-[#0f0f0f] border border-[#232323]"},mt={class:"text-xl font-semibold text-gray-100"},gt={class:"rounded-lg p-4 bg-[#0f0f0f] border border-[#232323]"},vt={class:"text-xl font-semibold text-green-300"},yt={class:"rounded-lg p-4 bg-[#0f0f0f] border border-[#232323]"},bt={class:"text-xl font-semibold text-yellow-300"},ht={class:"rounded-lg p-4 bg-[#0f0f0f] border border-[#232323]"},wt={class:"text-xl font-semibold text-white"},kt={key:1,class:"grid grid-cols-1 sm:grid-cols-5 gap-4 mb-6"},Et={class:"rounded-lg p-4 bg-[#0f0f0f] border border-[#232323]"},Dt={class:"text-xl font-semibold text-white"},St={class:"rounded-lg p-4 bg-[#0f0f0f] border border-[#232323]"},Pt={class:"text-xl font-semibold text-red-400"},Ft={class:"rounded-lg p-4 bg-[#0f0f0f] border border-[#232323]"},Nt={class:"text-xl font-semibold text-white"},At={class:"rounded-lg p-4 bg-[#0f0f0f] border border-[#232323]"},Ut={class:"text-xl font-semibold text-[#ffa236]"},Mt={class:"text-xs text-gray-400"},zt={class:"rounded-lg p-4 bg-[#0f0f0f] border border-[#232323]"},Tt={class:"text-xl font-semibold text-gray-100"},It={class:"text-xs text-gray-400"},Ct={class:"overflow-x-auto bg-[#0f0f0f] rounded-lg shadow"},Bt={class:"min-w-full text-sm text-gray-300"},Lt={class:"bg-[#1c1c1c] text-gray-400 uppercase text-xs"},Ht={key:0,class:"px-4 py-2 text-left"},Vt={key:1,class:"px-4 py-2 text-left"},jt={key:2,class:"px-4 py-2 text-left"},Rt={class:"px-4 py-2 text-right"},$t={key:0},Gt=["colspan"],Ot={class:"px-4 py-3 font-medium"},Wt={class:"px-4 py-3"},Yt={class:"px-4 py-3"},qt={class:"text-s"},Jt={key:0},Kt={key:1},Qt={key:2,class:"text-gray-500 text-s"},Xt={key:3},Zt={class:"px-4 py-3"},te={key:0,class:"bg-[#2a2a2a] px-2 py-1 rounded text-s capitalize"},ee={key:1,class:"text-gray-500"},se={class:"px-4 py-3"},oe={key:0,class:"px-4 py-3"},ae={class:"text-xs"},ne={key:0},le={key:1},re={key:1,class:"px-4 py-3"},de={class:"text-xs"},ie={key:2,class:"px-4 py-3"},ue={class:"px-4 py-3"},ce={class:"px-4 py-3 text-right space-x-2"},pe=["onClick"],xe={__name:"Index",props:{events:Object,artists:Array,canManageEvents:{type:Boolean,default:!1},canSeeFinance:{type:Boolean,default:!1}},setup(T){const i=T,{props:j}=K(),R=v(()=>{var o,t;return((t=(o=j.auth)==null?void 0:o.user)==null?void 0:t.role_names)||[]}),p=v(()=>R.value.includes("admin")),E=w("todos"),y=w("todos"),D=w(""),S=w(""),f=(o,t="USD")=>st(o,t),_=w(i.events&&i.events.data?[...i.events.data]:[]);C(()=>i.events,o=>{_.value=o&&o.data?[...o.data]:o||[]});const h=o=>{if(!o)return null;const t=new Date(o);return Number.isNaN(t.getTime())?null:(t.setHours(0,0,0,0),t)},$=()=>{const o=new Date;if(o.setHours(0,0,0,0),y.value==="personalizado")return{start:h(D.value),end:h(S.value)};const t=o.getFullYear(),s=o.getMonth();switch(y.value){case"mes_actual":return{start:new Date(t,s,1),end:new Date(t,s+1,0)};case"ultimo_mes":return{start:new Date(t,s-1,1),end:new Date(t,s,0)};case"ultimos_3_meses":return{start:new Date(t,s-2,1),end:new Date(t,s+1,0)};case"este_ano":return{start:new Date(t,0,1),end:new Date(t,11,31)};default:return{start:null,end:null}}},G=(o,t)=>!(!o||t.start&&o<t.start||t.end&&o>t.end),O=o=>String(o.status||"").toLowerCase()==="pagado"||!!o.is_paid,W=o=>{if(typeof o.is_upcoming=="boolean")return o.is_upcoming;const t=h(o.event_date);if(!t)return!1;const s=new Date;return s.setHours(0,0,0,0),t>s},Y=o=>{if(typeof o.is_past=="boolean")return o.is_past;const t=h(o.event_date);if(!t)return!1;const s=new Date;return s.setHours(0,0,0,0),t<s},x=v(()=>{const o=_.value.length?_.value:i.events&&i.events.data?i.events.data:i.events||[],t=$();return o.filter(s=>{var d,c;if(E.value!=="todos"&&(((d=s.main_artist)==null?void 0:d.id)||((c=s.mainArtist)==null?void 0:c.id)||s.main_artist_id)!=E.value)return!1;if(t.start||t.end){const g=h(s.event_date);if(!G(g,t))return!1}return!0})}),b=v(()=>{const o=x.value.length,t=x.value.filter(W).length,s=x.value.filter(Y).length,d=x.value.filter(O).length,c=Math.max(o-d,0),g=x.value.reduce((A,u)=>A+Number(u.show_fee_total??0),0);return{totalEvents:o,upcomingEvents:t,pastEvents:s,paidEvents:d,pendingEvents:c,totalFee:g}}),m=v(()=>{let o=0,t=0,s=0,d=0;for(const u of x.value)o+=Number(u.total_paid_base??u.totalPaid??u.total_paid??0),t+=Number(u.total_expenses_base??u.totalExpenses??u.total_expenses??0),s+=Number(u.artist_share_estimated_base??u.artist_share_estimated??u.artist_share??0),d+=Number(u.label_share_estimated_base??u.label_share_estimated??u.label_share??0);const c=o-t,g=c!==0?s/(c||1)*100:0,A=c!==0?d/(c||1)*100:0;return{totalPaid:o,totalExpenses:t,net:c,artistShare:s,labelShare:d,artistPct:g,labelPct:A}}),P=v(()=>!!i.canManageEvents),I=v(()=>!!i.canSeeFinance);C(y,o=>{o!=="personalizado"&&(D.value="",S.value="")});const q=o=>_.value.findIndex(t=>t.id===o),J=async o=>{if(!confirm("Â¿Eliminar este evento? Esta acciÃ³n no se puede deshacer."))return;const t=q(o);if(t===-1)return;const s=[..._.value];_.value.splice(t,1);try{const d=await Z.delete(route("admin.events.destroy",o));if(!(d.status>=200&&d.status<300))throw new Error("Server returned unexpected status: "+d.status)}catch(d){_.value=s,alert("No fue posible eliminar el evento. Intenta nuevamente."),console.error("Error deleting event",d)}};return(o,t)=>(a(),k(tt,{title:"Eventos"},{default:F(()=>[e("div",at,[e("div",null,[t[9]||(t[9]=e("h1",{class:"text-2xl font-semibold text-white mb-3"},"ğŸ« Eventos",-1)),e("div",nt,[e("div",lt,[t[5]||(t[5]=e("label",{class:"text-sm text-gray-400"},"Filtrar por artista:",-1)),N(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>E.value=s),class:"bg-[#1c1c1c] text-white border border-[#2a2a2a] rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#ffa236]"},[t[4]||(t[4]=e("option",{value:"todos"},"Todos los artistas",-1)),(a(!0),l(B,null,L(T.artists,s=>(a(),l("option",{key:s.id,value:s.id},n(s.name),9,rt))),128))],512),[[H,E.value]])]),e("div",dt,[t[7]||(t[7]=e("label",{class:"text-sm text-gray-400"},"Periodo:",-1)),N(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>y.value=s),class:"bg-[#1c1c1c] text-white border border-[#2a2a2a] rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#ffa236]"},[...t[6]||(t[6]=[e("option",{value:"todos"},"Todos",-1),e("option",{value:"mes_actual"},"Este mes",-1),e("option",{value:"ultimo_mes"},"Mes pasado",-1),e("option",{value:"ultimos_3_meses"},"Ãšltimos 3 meses",-1),e("option",{value:"este_ano"},"Este aÃ±o",-1),e("option",{value:"personalizado"},"Personalizado",-1)])],512),[[H,y.value]])]),y.value==="personalizado"?(a(),l("div",it,[N(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>D.value=s),type:"date",class:"bg-[#1c1c1c] text-white border border-[#2a2a2a] rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#ffa236]","aria-label":"Desde"},null,512),[[V,D.value]]),t[8]||(t[8]=e("span",{class:"text-gray-500 text-sm"},"â€”",-1)),N(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>S.value=s),type:"date",class:"bg-[#1c1c1c] text-white border border-[#2a2a2a] rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#ffa236]","aria-label":"Hasta"},null,512),[[V,S.value]])])):r("",!0)])]),P.value?(a(),k(U(M),{key:0,href:o.route("admin.events.create"),class:"bg-[#ffa236] hover:bg-[#ffb54d] text-black font-semibold px-4 py-2 rounded-md transition-colors"},{default:F(()=>[...t[10]||(t[10]=[z("+ Nuevo evento",-1)])]),_:1},8,["href"])):r("",!0)]),p.value?(a(),l("div",ut,[e("div",ct,[t[11]||(t[11]=e("p",{class:"text-xs text-gray-400"},"Total eventos",-1)),e("p",pt,n(b.value.totalEvents),1)]),e("div",xt,[t[12]||(t[12]=e("p",{class:"text-xs text-gray-400"},"PrÃ³ximos",-1)),e("p",ft,n(b.value.upcomingEvents),1)]),e("div",_t,[t[13]||(t[13]=e("p",{class:"text-xs text-gray-400"},"Pasados",-1)),e("p",mt,n(b.value.pastEvents),1)]),e("div",gt,[t[14]||(t[14]=e("p",{class:"text-xs text-gray-400"},"Pagados",-1)),e("p",vt,n(b.value.paidEvents),1)]),e("div",yt,[t[15]||(t[15]=e("p",{class:"text-xs text-gray-400"},"Pendientes",-1)),e("p",bt,n(b.value.pendingEvents),1)]),e("div",ht,[t[16]||(t[16]=e("p",{class:"text-xs text-gray-400"},"Fee negociado",-1)),e("p",wt,n(f(b.value.totalFee,"USD")),1)])])):r("",!0),p.value?(a(),l("div",kt,[e("div",Et,[t[17]||(t[17]=e("p",{class:"text-xs text-gray-400"},"Ingresos totales",-1)),e("p",Dt,n(f(m.value.totalPaid,"USD")),1)]),e("div",St,[t[18]||(t[18]=e("p",{class:"text-xs text-gray-400"},"Gastos totales",-1)),e("p",Pt,n(f(m.value.totalExpenses,"USD")),1)]),e("div",Ft,[t[19]||(t[19]=e("p",{class:"text-xs text-gray-400"},"Resultado neto",-1)),e("p",Nt,n(f(m.value.net,"USD")),1)]),e("div",At,[t[20]||(t[20]=e("p",{class:"text-xs text-gray-400"},"70% Artista",-1)),e("p",Ut,n(f(m.value.artistShare,"USD")),1),e("p",Mt,n(Math.round(m.value.artistPct))+"%",1)]),e("div",zt,[t[21]||(t[21]=e("p",{class:"text-xs text-gray-400"},"30% CompaÃ±Ã­a",-1)),e("p",Tt,n(f(m.value.labelShare,"USD")),1),e("p",It,n(Math.round(m.value.labelPct))+"%",1)])])):r("",!0),e("div",Ct,[e("table",Bt,[e("thead",Lt,[e("tr",null,[t[22]||(t[22]=e("th",{class:"px-4 py-2 text-left"},"TÃ­tulo",-1)),t[23]||(t[23]=e("th",{class:"px-4 py-2 text-left"},"Fecha",-1)),t[24]||(t[24]=e("th",{class:"px-4 py-2 text-left"},"UbicaciÃ³n",-1)),t[25]||(t[25]=e("th",{class:"px-4 py-2 text-left"},"Tipo",-1)),t[26]||(t[26]=e("th",{class:"px-4 py-2 text-left"},"Estado",-1)),p.value?(a(),l("th",Ht,"Fee / Moneda")):r("",!0),p.value?(a(),l("th",Vt,"% Anticipo")):r("",!0),p.value?(a(),l("th",jt,"Pago final")):r("",!0),t[27]||(t[27]=e("th",{class:"px-4 py-2 text-left"},"Artista Principal",-1)),e("th",Rt,n(P.value?"Acciones":I.value?"Finanzas":""),1)])]),e("tbody",null,[x.value.length===0?(a(),l("tr",$t,[e("td",{colspan:p.value?10:7,class:"px-4 py-6 text-center text-gray-500"}," No hay eventos con los filtros seleccionados. ",8,Gt)])):r("",!0),(a(!0),l(B,null,L(x.value,s=>{var d,c;return a(),l("tr",{key:s.id,class:"border-b border-[#2a2a2a] hover:bg-[#181818]"},[e("td",Ot,n(s.title),1),e("td",Wt,n(s.event_date?new Date(s.event_date).toLocaleDateString("es-ES"):"-"),1),e("td",Yt,[e("div",qt,[s.city||s.country?(a(),l("p",Jt,n(s.city)+n(s.city&&s.country?",":"")+" "+n(s.country),1)):r("",!0),s.location?(a(),l("p",Kt,n(s.location),1)):r("",!0),s.venue_address?(a(),l("p",Qt,"Venue: "+n(s.venue_address),1)):r("",!0),!s.city&&!s.country&&!s.location&&!s.venue_address?(a(),l("p",Xt,"â€”")):r("",!0)])]),e("td",Zt,[s.event_type?(a(),l("span",te,n(s.event_type),1)):(a(),l("span",ee,"â€”"))]),e("td",se,[e("span",{class:Q(["px-2 py-1 rounded-full text-s font-semibold",s.status==="pagado"?"bg-green-500/20 text-green-300":s.status==="confirmado"?"bg-blue-500/20 text-blue-300":s.status==="pospuesto"?"bg-orange-500/20 text-orange-300":s.status==="cancelado"?"bg-red-500/20 text-red-300":"bg-yellow-500/20 text-yellow-300"])},n(s.status||"Sin estado"),3)]),p.value?(a(),l("td",oe,[e("div",ae,[s.show_fee_total?(a(),l("p",ne,n(f(s.show_fee_total,s.currency||"USD")),1)):(a(),l("p",le,"â€”"))])])):r("",!0),p.value?(a(),l("td",re,[e("span",de,n(s.advance_percentage??50)+"%",1)])):r("",!0),p.value?(a(),l("td",ie,n(s.full_payment_due_date?new Date(s.full_payment_due_date).toLocaleDateString("es-ES"):"â€”"),1)):r("",!0),e("td",ue,n(((d=s.main_artist)==null?void 0:d.name)||((c=s.mainArtist)==null?void 0:c.name)||"-"),1),e("td",ce,[P.value?(a(),k(U(M),{key:0,href:o.route("admin.events.edit",s.id),class:"text-[#ffa236] hover:underline text-sm"},{default:F(()=>[...t[28]||(t[28]=[z(" Editar ",-1)])]),_:1},8,["href"])):r("",!0),I.value?(a(),k(U(M),{key:1,href:o.route("admin.events.finance",s.id),class:"text-green-400 hover:underline text-sm"},{default:F(()=>[...t[29]||(t[29]=[z(" Finanzas ",-1)])]),_:1},8,["href"])):r("",!0),P.value?(a(),l("button",{key:2,type:"button",class:"text-red-400 hover:underline text-sm",onClick:X(g=>J(s.id),["prevent"])}," Eliminar ",8,pe)):r("",!0)])])}),128))])])]),i.events&&i.events.links?(a(),k(et,{key:2,links:i.events.links,meta:i.events.meta,class:"justify-end mt-4"},null,8,["links","meta"])):r("",!0)]),_:1}))}},he=ot(xe,[["__scopeId","data-v-3826f9c6"]]);export{he as default};
