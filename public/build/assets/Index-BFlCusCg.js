import{s as K,x as v,d as w,y as C,c as P,w as F,a as e,e as l,f as d,j as N,o as n,F as B,i as L,t as a,k as H,v as V,g as U,m as M,h as z,n as Q,l as X,A as Z}from"./app-CrI6ItK6.js";import{A as tt}from"./AdminLayout-Byn75LEi.js";import{f as et}from"./money-kgxah7JU.js";import{_ as st}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css            */import"./responsive-blanco-DOkwJ8BK.js";const ot={class:"flex justify-between items-center mb-6"},at={class:"flex flex-wrap items-center gap-4"},nt={class:"flex items-center gap-3"},lt=["value"],rt={class:"flex items-center gap-3"},dt={key:0,class:"flex items-center gap-2"},it={key:0,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-6 gap-4 mb-6"},ut={class:"rounded-lg p-4 bg-[#0f0f0f] border border-[#232323]"},ct={class:"text-xl font-semibold text-white"},pt={class:"rounded-lg p-4 bg-[#0f0f0f] border border-[#232323]"},xt={class:"text-xl font-semibold text-emerald-300"},ft={class:"rounded-lg p-4 bg-[#0f0f0f] border border-[#232323]"},_t={class:"text-xl font-semibold text-gray-100"},mt={class:"rounded-lg p-4 bg-[#0f0f0f] border border-[#232323]"},gt={class:"text-xl font-semibold text-green-300"},vt={class:"rounded-lg p-4 bg-[#0f0f0f] border border-[#232323]"},yt={class:"text-xl font-semibold text-yellow-300"},bt={class:"rounded-lg p-4 bg-[#0f0f0f] border border-[#232323]"},ht={class:"text-xl font-semibold text-white"},wt={key:1,class:"grid grid-cols-1 sm:grid-cols-5 gap-4 mb-6"},Et={class:"rounded-lg p-4 bg-[#0f0f0f] border border-[#232323]"},kt={class:"text-xl font-semibold text-white"},Dt={class:"rounded-lg p-4 bg-[#0f0f0f] border border-[#232323]"},St={class:"text-xl font-semibold text-red-400"},Pt={class:"rounded-lg p-4 bg-[#0f0f0f] border border-[#232323]"},Ft={class:"text-xl font-semibold text-white"},Nt={class:"rounded-lg p-4 bg-[#0f0f0f] border border-[#232323]"},At={class:"text-xl font-semibold text-[#ffa236]"},Ut={class:"text-xs text-gray-400"},Mt={class:"rounded-lg p-4 bg-[#0f0f0f] border border-[#232323]"},zt={class:"text-xl font-semibold text-gray-100"},Tt={class:"text-xs text-gray-400"},It={class:"overflow-x-auto bg-[#0f0f0f] rounded-lg shadow"},Ct={class:"min-w-full text-sm text-gray-300"},Bt={class:"bg-[#1c1c1c] text-gray-400 uppercase text-xs"},Lt={key:0,class:"px-4 py-2 text-left"},Ht={key:1,class:"px-4 py-2 text-left"},Vt={key:2,class:"px-4 py-2 text-left"},Rt={class:"px-4 py-2 text-right"},jt={key:0},Gt=["colspan"],Ot={class:"px-4 py-3 font-medium"},Wt={class:"px-4 py-3"},Yt={class:"px-4 py-3"},$t={class:"text-s"},qt={key:0},Jt={key:1},Kt={key:2,class:"text-gray-500 text-s"},Qt={key:3},Xt={class:"px-4 py-3"},Zt={key:0,class:"bg-[#2a2a2a] px-2 py-1 rounded text-s capitalize"},te={key:1,class:"text-gray-500"},ee={class:"px-4 py-3"},se={key:0,class:"px-4 py-3"},oe={class:"text-xs"},ae={key:0},ne={key:1},le={key:1,class:"px-4 py-3"},re={class:"text-xs"},de={key:2,class:"px-4 py-3"},ie={class:"px-4 py-3"},ue={class:"px-4 py-3 text-right space-x-2"},ce=["onClick"],pe={__name:"Index",props:{events:Object,artists:Array,canManageEvents:{type:Boolean,default:!1},canSeeFinance:{type:Boolean,default:!1}},setup(T){const c=T,{props:R}=K(),j=v(()=>{var o,t;return((t=(o=R.auth)==null?void 0:o.user)==null?void 0:t.role_names)||[]}),p=v(()=>j.value.includes("admin")),E=w("todos"),y=w("todos"),k=w(""),D=w(""),f=(o,t="USD")=>et(o,t),_=w(c.events&&c.events.data?[...c.events.data]:[]);C(()=>c.events,o=>{_.value=o&&o.data?[...o.data]:o||[]});const h=o=>{if(!o)return null;const t=new Date(o);return Number.isNaN(t.getTime())?null:(t.setHours(0,0,0,0),t)},G=()=>{const o=new Date;if(o.setHours(0,0,0,0),y.value==="personalizado")return{start:h(k.value),end:h(D.value)};const t=o.getFullYear(),s=o.getMonth();switch(y.value){case"mes_actual":return{start:new Date(t,s,1),end:new Date(t,s+1,0)};case"ultimo_mes":return{start:new Date(t,s-1,1),end:new Date(t,s,0)};case"ultimos_3_meses":return{start:new Date(t,s-2,1),end:new Date(t,s+1,0)};case"este_ano":return{start:new Date(t,0,1),end:new Date(t,11,31)};default:return{start:null,end:null}}},O=(o,t)=>!(!o||t.start&&o<t.start||t.end&&o>t.end),W=o=>String(o.status||"").toLowerCase()==="pagado"||!!o.is_paid,Y=o=>{if(typeof o.is_upcoming=="boolean")return o.is_upcoming;const t=h(o.event_date);if(!t)return!1;const s=new Date;return s.setHours(0,0,0,0),t>s},$=o=>{if(typeof o.is_past=="boolean")return o.is_past;const t=h(o.event_date);if(!t)return!1;const s=new Date;return s.setHours(0,0,0,0),t<s},x=v(()=>{const o=_.value.length?_.value:c.events&&c.events.data?c.events.data:c.events||[],t=G();return o.filter(s=>{var r,u;if(E.value!=="todos"&&(((r=s.main_artist)==null?void 0:r.id)||((u=s.mainArtist)==null?void 0:u.id)||s.main_artist_id)!=E.value)return!1;if(t.start||t.end){const g=h(s.event_date);if(!O(g,t))return!1}return!0})}),b=v(()=>{const o=x.value.length,t=x.value.filter(Y).length,s=x.value.filter($).length,r=x.value.filter(W).length,u=Math.max(o-r,0),g=x.value.reduce((A,i)=>A+Number(i.show_fee_total??0),0);return{totalEvents:o,upcomingEvents:t,pastEvents:s,paidEvents:r,pendingEvents:u,totalFee:g}}),m=v(()=>{let o=0,t=0,s=0,r=0;for(const i of x.value)o+=Number(i.total_paid_base??i.totalPaid??i.total_paid??0),t+=Number(i.total_expenses_base??i.totalExpenses??i.total_expenses??0),s+=Number(i.artist_share_estimated_base??i.artist_share_estimated??i.artist_share??0),r+=Number(i.label_share_estimated_base??i.label_share_estimated??i.label_share??0);const u=o-t,g=u!==0?s/(u||1)*100:0,A=u!==0?r/(u||1)*100:0;return{totalPaid:o,totalExpenses:t,net:u,artistShare:s,labelShare:r,artistPct:g,labelPct:A}}),S=v(()=>!!c.canManageEvents),I=v(()=>!!c.canSeeFinance);C(y,o=>{o!=="personalizado"&&(k.value="",D.value="")});const q=o=>_.value.findIndex(t=>t.id===o),J=async o=>{if(!confirm("Â¿Eliminar este evento? Esta acciÃ³n no se puede deshacer."))return;const t=q(o);if(t===-1)return;const s=[..._.value];_.value.splice(t,1);try{const r=await Z.delete(route("admin.events.destroy",o));if(!(r.status>=200&&r.status<300))throw new Error("Server returned unexpected status: "+r.status)}catch(r){_.value=s,alert("No fue posible eliminar el evento. Intenta nuevamente."),console.error("Error deleting event",r)}};return(o,t)=>(n(),P(tt,{title:"Eventos"},{default:F(()=>[e("div",ot,[e("div",null,[t[9]||(t[9]=e("h1",{class:"text-2xl font-semibold text-white mb-3"},"ğŸ« Eventos",-1)),e("div",at,[e("div",nt,[t[5]||(t[5]=e("label",{class:"text-sm text-gray-400"},"Filtrar por artista:",-1)),N(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>E.value=s),class:"bg-[#1c1c1c] text-white border border-[#2a2a2a] rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#ffa236]"},[t[4]||(t[4]=e("option",{value:"todos"},"Todos los artistas",-1)),(n(!0),l(B,null,L(T.artists,s=>(n(),l("option",{key:s.id,value:s.id},a(s.name),9,lt))),128))],512),[[H,E.value]])]),e("div",rt,[t[7]||(t[7]=e("label",{class:"text-sm text-gray-400"},"Periodo:",-1)),N(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>y.value=s),class:"bg-[#1c1c1c] text-white border border-[#2a2a2a] rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#ffa236]"},[...t[6]||(t[6]=[e("option",{value:"todos"},"Todos",-1),e("option",{value:"mes_actual"},"Este mes",-1),e("option",{value:"ultimo_mes"},"Mes pasado",-1),e("option",{value:"ultimos_3_meses"},"Ãšltimos 3 meses",-1),e("option",{value:"este_ano"},"Este aÃ±o",-1),e("option",{value:"personalizado"},"Personalizado",-1)])],512),[[H,y.value]])]),y.value==="personalizado"?(n(),l("div",dt,[N(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>k.value=s),type:"date",class:"bg-[#1c1c1c] text-white border border-[#2a2a2a] rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#ffa236]","aria-label":"Desde"},null,512),[[V,k.value]]),t[8]||(t[8]=e("span",{class:"text-gray-500 text-sm"},"â€”",-1)),N(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>D.value=s),type:"date",class:"bg-[#1c1c1c] text-white border border-[#2a2a2a] rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#ffa236]","aria-label":"Hasta"},null,512),[[V,D.value]])])):d("",!0)])]),S.value?(n(),P(U(M),{key:0,href:o.route("admin.events.create"),class:"bg-[#ffa236] hover:bg-[#ffb54d] text-black font-semibold px-4 py-2 rounded-md transition-colors"},{default:F(()=>[...t[10]||(t[10]=[z("+ Nuevo evento",-1)])]),_:1},8,["href"])):d("",!0)]),p.value?(n(),l("div",it,[e("div",ut,[t[11]||(t[11]=e("p",{class:"text-xs text-gray-400"},"Total eventos",-1)),e("p",ct,a(b.value.totalEvents),1)]),e("div",pt,[t[12]||(t[12]=e("p",{class:"text-xs text-gray-400"},"PrÃ³ximos",-1)),e("p",xt,a(b.value.upcomingEvents),1)]),e("div",ft,[t[13]||(t[13]=e("p",{class:"text-xs text-gray-400"},"Pasados",-1)),e("p",_t,a(b.value.pastEvents),1)]),e("div",mt,[t[14]||(t[14]=e("p",{class:"text-xs text-gray-400"},"Pagados",-1)),e("p",gt,a(b.value.paidEvents),1)]),e("div",vt,[t[15]||(t[15]=e("p",{class:"text-xs text-gray-400"},"Pendientes",-1)),e("p",yt,a(b.value.pendingEvents),1)]),e("div",bt,[t[16]||(t[16]=e("p",{class:"text-xs text-gray-400"},"Fee negociado",-1)),e("p",ht,a(f(b.value.totalFee,"USD")),1)])])):d("",!0),p.value?(n(),l("div",wt,[e("div",Et,[t[17]||(t[17]=e("p",{class:"text-xs text-gray-400"},"Ingresos totales",-1)),e("p",kt,a(f(m.value.totalPaid,"USD")),1)]),e("div",Dt,[t[18]||(t[18]=e("p",{class:"text-xs text-gray-400"},"Gastos totales",-1)),e("p",St,a(f(m.value.totalExpenses,"USD")),1)]),e("div",Pt,[t[19]||(t[19]=e("p",{class:"text-xs text-gray-400"},"Resultado neto",-1)),e("p",Ft,a(f(m.value.net,"USD")),1)]),e("div",Nt,[t[20]||(t[20]=e("p",{class:"text-xs text-gray-400"},"70% Artista",-1)),e("p",At,a(f(m.value.artistShare,"USD")),1),e("p",Ut,a(Math.round(m.value.artistPct))+"%",1)]),e("div",Mt,[t[21]||(t[21]=e("p",{class:"text-xs text-gray-400"},"30% CompaÃ±Ã­a",-1)),e("p",zt,a(f(m.value.labelShare,"USD")),1),e("p",Tt,a(Math.round(m.value.labelPct))+"%",1)])])):d("",!0),e("div",It,[e("table",Ct,[e("thead",Bt,[e("tr",null,[t[22]||(t[22]=e("th",{class:"px-4 py-2 text-left"},"TÃ­tulo",-1)),t[23]||(t[23]=e("th",{class:"px-4 py-2 text-left"},"Fecha",-1)),t[24]||(t[24]=e("th",{class:"px-4 py-2 text-left"},"UbicaciÃ³n",-1)),t[25]||(t[25]=e("th",{class:"px-4 py-2 text-left"},"Tipo",-1)),t[26]||(t[26]=e("th",{class:"px-4 py-2 text-left"},"Estado",-1)),p.value?(n(),l("th",Lt,"Fee / Moneda")):d("",!0),p.value?(n(),l("th",Ht,"% Anticipo")):d("",!0),p.value?(n(),l("th",Vt,"Pago final")):d("",!0),t[27]||(t[27]=e("th",{class:"px-4 py-2 text-left"},"Artista Principal",-1)),e("th",Rt,a(S.value?"Acciones":I.value?"Finanzas":""),1)])]),e("tbody",null,[x.value.length===0?(n(),l("tr",jt,[e("td",{colspan:p.value?10:7,class:"px-4 py-6 text-center text-gray-500"}," No hay eventos con los filtros seleccionados. ",8,Gt)])):d("",!0),(n(!0),l(B,null,L(x.value,s=>{var r,u;return n(),l("tr",{key:s.id,class:"border-b border-[#2a2a2a] hover:bg-[#181818]"},[e("td",Ot,a(s.title),1),e("td",Wt,a(s.event_date?new Date(s.event_date).toLocaleDateString("es-ES"):"-"),1),e("td",Yt,[e("div",$t,[s.city||s.country?(n(),l("p",qt,a(s.city)+a(s.city&&s.country?",":"")+" "+a(s.country),1)):d("",!0),s.location?(n(),l("p",Jt,a(s.location),1)):d("",!0),s.venue_address?(n(),l("p",Kt,"Venue: "+a(s.venue_address),1)):d("",!0),!s.city&&!s.country&&!s.location&&!s.venue_address?(n(),l("p",Qt,"â€”")):d("",!0)])]),e("td",Xt,[s.event_type?(n(),l("span",Zt,a(s.event_type),1)):(n(),l("span",te,"â€”"))]),e("td",ee,[e("span",{class:Q(["px-2 py-1 rounded-full text-s font-semibold",s.status==="pagado"?"bg-green-500/20 text-green-300":s.status==="confirmado"?"bg-blue-500/20 text-blue-300":s.status==="pospuesto"?"bg-orange-500/20 text-orange-300":s.status==="cancelado"?"bg-red-500/20 text-red-300":"bg-yellow-500/20 text-yellow-300"])},a(s.status||"Sin estado"),3)]),p.value?(n(),l("td",se,[e("div",oe,[s.show_fee_total?(n(),l("p",ae,a(f(s.show_fee_total,s.currency||"USD")),1)):(n(),l("p",ne,"â€”"))])])):d("",!0),p.value?(n(),l("td",le,[e("span",re,a(s.advance_percentage??50)+"%",1)])):d("",!0),p.value?(n(),l("td",de,a(s.full_payment_due_date?new Date(s.full_payment_due_date).toLocaleDateString("es-ES"):"â€”"),1)):d("",!0),e("td",ie,a(((r=s.main_artist)==null?void 0:r.name)||((u=s.mainArtist)==null?void 0:u.name)||"-"),1),e("td",ue,[S.value?(n(),P(U(M),{key:0,href:o.route("admin.events.edit",s.id),class:"text-[#ffa236] hover:underline text-sm"},{default:F(()=>[...t[28]||(t[28]=[z(" Editar ",-1)])]),_:1},8,["href"])):d("",!0),I.value?(n(),P(U(M),{key:1,href:o.route("admin.events.finance",s.id),class:"text-green-400 hover:underline text-sm"},{default:F(()=>[...t[29]||(t[29]=[z(" Finanzas ",-1)])]),_:1},8,["href"])):d("",!0),S.value?(n(),l("button",{key:2,type:"button",class:"text-red-400 hover:underline text-sm",onClick:X(g=>J(s.id),["prevent"])}," Eliminar ",8,ce)):d("",!0)])])}),128))])])])]),_:1}))}},ye=st(pe,[["__scopeId","data-v-455dccf4"]]);export{ye as default};
