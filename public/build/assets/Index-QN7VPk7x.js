import{s as K,x as g,d as E,y as C,c as P,w as F,a as e,e as l,f as d,j as A,o as n,F as B,i as L,t as a,k as H,v as V,g as M,m as z,h as I,n as Q,l as X,A as Z}from"./app-BkiIwDrh.js";import{A as tt}from"./AdminLayout-DEGJtv-D.js";import{_ as et}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css            */import"./responsive-blanco-DOkwJ8BK.js";const st={class:"flex justify-between items-center mb-6"},ot={class:"flex flex-wrap items-center gap-4"},at={class:"flex items-center gap-3"},nt=["value"],lt={class:"flex items-center gap-3"},rt={key:0,class:"flex items-center gap-2"},dt={key:0,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-6 gap-4 mb-6"},it={class:"rounded-lg p-4 bg-[#0f0f0f] border border-[#232323]"},ut={class:"text-xl font-semibold text-white"},ct={class:"rounded-lg p-4 bg-[#0f0f0f] border border-[#232323]"},pt={class:"text-xl font-semibold text-emerald-300"},xt={class:"rounded-lg p-4 bg-[#0f0f0f] border border-[#232323]"},ft={class:"text-xl font-semibold text-gray-100"},_t={class:"rounded-lg p-4 bg-[#0f0f0f] border border-[#232323]"},mt={class:"text-xl font-semibold text-green-300"},gt={class:"rounded-lg p-4 bg-[#0f0f0f] border border-[#232323]"},bt={class:"text-xl font-semibold text-yellow-300"},vt={class:"rounded-lg p-4 bg-[#0f0f0f] border border-[#232323]"},yt={class:"text-xl font-semibold text-white"},ht={key:1,class:"grid grid-cols-1 sm:grid-cols-5 gap-4 mb-6"},wt={class:"rounded-lg p-4 bg-[#0f0f0f] border border-[#232323]"},Et={class:"text-xl font-semibold text-white"},kt={class:"rounded-lg p-4 bg-[#0f0f0f] border border-[#232323]"},Dt={class:"text-xl font-semibold text-red-400"},St={class:"rounded-lg p-4 bg-[#0f0f0f] border border-[#232323]"},Nt={class:"text-xl font-semibold text-white"},Pt={class:"rounded-lg p-4 bg-[#0f0f0f] border border-[#232323]"},Ft={class:"text-xl font-semibold text-[#ffa236]"},At={class:"text-xs text-gray-400"},Ut={class:"rounded-lg p-4 bg-[#0f0f0f] border border-[#232323]"},Mt={class:"text-xl font-semibold text-gray-100"},zt={class:"text-xs text-gray-400"},It={class:"overflow-x-auto bg-[#0f0f0f] rounded-lg shadow"},Tt={class:"min-w-full text-sm text-gray-300"},Ct={class:"bg-[#1c1c1c] text-gray-400 uppercase text-xs"},Bt={key:0,class:"px-4 py-2 text-left"},Lt={key:1,class:"px-4 py-2 text-left"},Ht={key:2,class:"px-4 py-2 text-left"},Vt={class:"px-4 py-2 text-right"},Rt={key:0},$t=["colspan"],jt={class:"px-4 py-3 font-medium"},Gt={class:"px-4 py-3"},Ot={class:"px-4 py-3"},Wt={class:"text-s"},Yt={key:0},qt={key:1},Jt={key:2,class:"text-gray-500 text-s"},Kt={key:3},Qt={class:"px-4 py-3"},Xt={key:0,class:"bg-[#2a2a2a] px-2 py-1 rounded text-s capitalize"},Zt={key:1,class:"text-gray-500"},te={class:"px-4 py-3"},ee={key:0,class:"px-4 py-3"},se={class:"text-xs"},oe={key:0},ae={key:1},ne={key:1,class:"px-4 py-3"},le={class:"text-xs"},re={key:2,class:"px-4 py-3"},de={class:"px-4 py-3"},ie={class:"px-4 py-3 text-right space-x-2"},ue=["onClick"],ce={__name:"Index",props:{events:Object,artists:Array,canManageEvents:{type:Boolean,default:!1},canSeeFinance:{type:Boolean,default:!1}},setup(T){const c=T,{props:R}=K(),$=g(()=>{var o,t;return((t=(o=R.auth)==null?void 0:o.user)==null?void 0:t.role_names)||[]}),x=g(()=>$.value.includes("admin")),k=E("todos"),b=E("todos"),D=E(""),S=E(""),v=(o,t="USD")=>{const s=Number(o??0);if(Number.isNaN(s))return`${t} 0,00`;try{return new Intl.NumberFormat("es-ES",{style:"currency",currency:t}).format(s)}catch{return`${t} ${s.toFixed(2)}`}},f=E(c.events&&c.events.data?[...c.events.data]:[]);C(()=>c.events,o=>{f.value=o&&o.data?[...o.data]:o||[]});const h=o=>{if(!o)return null;const t=new Date(o);return Number.isNaN(t.getTime())?null:(t.setHours(0,0,0,0),t)},j=()=>{const o=new Date;if(o.setHours(0,0,0,0),b.value==="personalizado")return{start:h(D.value),end:h(S.value)};const t=o.getFullYear(),s=o.getMonth();switch(b.value){case"mes_actual":return{start:new Date(t,s,1),end:new Date(t,s+1,0)};case"ultimo_mes":return{start:new Date(t,s-1,1),end:new Date(t,s,0)};case"ultimos_3_meses":return{start:new Date(t,s-2,1),end:new Date(t,s+1,0)};case"este_ano":return{start:new Date(t,0,1),end:new Date(t,11,31)};default:return{start:null,end:null}}},G=(o,t)=>!(!o||t.start&&o<t.start||t.end&&o>t.end),O=o=>String(o.status||"").toLowerCase()==="pagado"||!!o.is_paid,W=o=>{if(typeof o.is_upcoming=="boolean")return o.is_upcoming;const t=h(o.event_date);if(!t)return!1;const s=new Date;return s.setHours(0,0,0,0),t>s},Y=o=>{if(typeof o.is_past=="boolean")return o.is_past;const t=h(o.event_date);if(!t)return!1;const s=new Date;return s.setHours(0,0,0,0),t<s},p=g(()=>{const o=f.value.length?f.value:c.events&&c.events.data?c.events.data:c.events||[],t=j();return o.filter(s=>{var r,u;if(k.value!=="todos"&&(((r=s.main_artist)==null?void 0:r.id)||((u=s.mainArtist)==null?void 0:u.id)||s.main_artist_id)!=k.value)return!1;if(t.start||t.end){const m=h(s.event_date);if(!G(m,t))return!1}return!0})}),y=g(()=>{const o=p.value.length,t=p.value.filter(W).length,s=p.value.filter(Y).length,r=p.value.filter(O).length,u=Math.max(o-r,0),m=p.value.reduce((U,i)=>U+Number(i.show_fee_total??0),0);return{totalEvents:o,upcomingEvents:t,pastEvents:s,paidEvents:r,pendingEvents:u,totalFee:m}}),_=g(()=>{let o=0,t=0,s=0,r=0;for(const i of p.value)o+=Number(i.total_paid_base??i.totalPaid??i.total_paid??0),t+=Number(i.total_expenses_base??i.totalExpenses??i.total_expenses??0),s+=Number(i.artist_share_estimated_base??i.artist_share_estimated??i.artist_share??0),r+=Number(i.label_share_estimated_base??i.label_share_estimated??i.label_share??0);const u=o-t,m=u!==0?s/(u||1)*100:0,U=u!==0?r/(u||1)*100:0;return{totalPaid:o,totalExpenses:t,net:u,artistShare:s,labelShare:r,artistPct:m,labelPct:U}}),N=g(()=>!!c.canManageEvents),w=g(()=>!!c.canSeeFinance);C(b,o=>{o!=="personalizado"&&(D.value="",S.value="")});const q=o=>f.value.findIndex(t=>t.id===o),J=async o=>{if(!confirm("Â¿Eliminar este evento? Esta acciÃ³n no se puede deshacer."))return;const t=q(o);if(t===-1)return;const s=[...f.value];f.value.splice(t,1);try{const r=await Z.delete(route("admin.events.destroy",o));if(!(r.status>=200&&r.status<300))throw new Error("Server returned unexpected status: "+r.status)}catch(r){f.value=s,alert("No fue posible eliminar el evento. Intenta nuevamente."),console.error("Error deleting event",r)}};return(o,t)=>(n(),P(tt,{title:"Eventos"},{default:F(()=>[e("div",st,[e("div",null,[t[9]||(t[9]=e("h1",{class:"text-2xl font-semibold text-white mb-3"},"ğŸ« Eventos",-1)),e("div",ot,[e("div",at,[t[5]||(t[5]=e("label",{class:"text-sm text-gray-400"},"Filtrar por artista:",-1)),A(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>k.value=s),class:"bg-[#1c1c1c] text-white border border-[#2a2a2a] rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#ffa236]"},[t[4]||(t[4]=e("option",{value:"todos"},"Todos los artistas",-1)),(n(!0),l(B,null,L(T.artists,s=>(n(),l("option",{key:s.id,value:s.id},a(s.name),9,nt))),128))],512),[[H,k.value]])]),e("div",lt,[t[7]||(t[7]=e("label",{class:"text-sm text-gray-400"},"Periodo:",-1)),A(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>b.value=s),class:"bg-[#1c1c1c] text-white border border-[#2a2a2a] rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#ffa236]"},[...t[6]||(t[6]=[e("option",{value:"todos"},"Todos",-1),e("option",{value:"mes_actual"},"Este mes",-1),e("option",{value:"ultimo_mes"},"Mes pasado",-1),e("option",{value:"ultimos_3_meses"},"Ãšltimos 3 meses",-1),e("option",{value:"este_ano"},"Este aÃ±o",-1),e("option",{value:"personalizado"},"Personalizado",-1)])],512),[[H,b.value]])]),b.value==="personalizado"?(n(),l("div",rt,[A(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>D.value=s),type:"date",class:"bg-[#1c1c1c] text-white border border-[#2a2a2a] rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#ffa236]","aria-label":"Desde"},null,512),[[V,D.value]]),t[8]||(t[8]=e("span",{class:"text-gray-500 text-sm"},"â€”",-1)),A(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>S.value=s),type:"date",class:"bg-[#1c1c1c] text-white border border-[#2a2a2a] rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#ffa236]","aria-label":"Hasta"},null,512),[[V,S.value]])])):d("",!0)])]),N.value?(n(),P(M(z),{key:0,href:o.route("admin.events.create"),class:"bg-[#ffa236] hover:bg-[#ffb54d] text-black font-semibold px-4 py-2 rounded-md transition-colors"},{default:F(()=>[...t[10]||(t[10]=[I("+ Nuevo evento",-1)])]),_:1},8,["href"])):d("",!0)]),x.value?(n(),l("div",dt,[e("div",it,[t[11]||(t[11]=e("p",{class:"text-xs text-gray-400"},"Total eventos",-1)),e("p",ut,a(y.value.totalEvents),1)]),e("div",ct,[t[12]||(t[12]=e("p",{class:"text-xs text-gray-400"},"PrÃ³ximos",-1)),e("p",pt,a(y.value.upcomingEvents),1)]),e("div",xt,[t[13]||(t[13]=e("p",{class:"text-xs text-gray-400"},"Pasados",-1)),e("p",ft,a(y.value.pastEvents),1)]),e("div",_t,[t[14]||(t[14]=e("p",{class:"text-xs text-gray-400"},"Pagados",-1)),e("p",mt,a(y.value.paidEvents),1)]),e("div",gt,[t[15]||(t[15]=e("p",{class:"text-xs text-gray-400"},"Pendientes",-1)),e("p",bt,a(y.value.pendingEvents),1)]),e("div",vt,[t[16]||(t[16]=e("p",{class:"text-xs text-gray-400"},"Fee negociado",-1)),e("p",yt,a(v(y.value.totalFee,"USD")),1)])])):d("",!0),x.value?(n(),l("div",ht,[e("div",wt,[t[17]||(t[17]=e("p",{class:"text-xs text-gray-400"},"Ingresos totales",-1)),e("p",Et,a(v(_.value.totalPaid,"USD")),1)]),e("div",kt,[t[18]||(t[18]=e("p",{class:"text-xs text-gray-400"},"Gastos totales",-1)),e("p",Dt,a(v(_.value.totalExpenses,"USD")),1)]),e("div",St,[t[19]||(t[19]=e("p",{class:"text-xs text-gray-400"},"Resultado neto",-1)),e("p",Nt,a(v(_.value.net,"USD")),1)]),e("div",Pt,[t[20]||(t[20]=e("p",{class:"text-xs text-gray-400"},"70% Artista",-1)),e("p",Ft,a(v(_.value.artistShare,"USD")),1),e("p",At,a(Math.round(_.value.artistPct))+"%",1)]),e("div",Ut,[t[21]||(t[21]=e("p",{class:"text-xs text-gray-400"},"30% CompaÃ±Ã­a",-1)),e("p",Mt,a(v(_.value.labelShare,"USD")),1),e("p",zt,a(Math.round(_.value.labelPct))+"%",1)])])):d("",!0),e("div",It,[e("table",Tt,[e("thead",Ct,[e("tr",null,[t[22]||(t[22]=e("th",{class:"px-4 py-2 text-left"},"TÃ­tulo",-1)),t[23]||(t[23]=e("th",{class:"px-4 py-2 text-left"},"Fecha",-1)),t[24]||(t[24]=e("th",{class:"px-4 py-2 text-left"},"UbicaciÃ³n",-1)),t[25]||(t[25]=e("th",{class:"px-4 py-2 text-left"},"Tipo",-1)),t[26]||(t[26]=e("th",{class:"px-4 py-2 text-left"},"Estado",-1)),x.value?(n(),l("th",Bt,"Fee / Moneda")):d("",!0),x.value?(n(),l("th",Lt,"% Anticipo")):d("",!0),w.value?(n(),l("th",Ht,"Pago final")):d("",!0),t[27]||(t[27]=e("th",{class:"px-4 py-2 text-left"},"Artista Principal",-1)),e("th",Vt,a(N.value?"Acciones":w.value?"Finanzas":""),1)])]),e("tbody",null,[p.value.length===0?(n(),l("tr",Rt,[e("td",{colspan:x.value?10:w.value?8:7,class:"px-4 py-6 text-center text-gray-500"}," No hay eventos con los filtros seleccionados. ",8,$t)])):d("",!0),(n(!0),l(B,null,L(p.value,s=>{var r,u;return n(),l("tr",{key:s.id,class:"border-b border-[#2a2a2a] hover:bg-[#181818]"},[e("td",jt,a(s.title),1),e("td",Gt,a(s.event_date?new Date(s.event_date).toLocaleDateString("es-ES"):"-"),1),e("td",Ot,[e("div",Wt,[s.city||s.country?(n(),l("p",Yt,a(s.city)+a(s.city&&s.country?",":"")+" "+a(s.country),1)):d("",!0),s.location?(n(),l("p",qt,a(s.location),1)):d("",!0),s.venue_address?(n(),l("p",Jt,"Venue: "+a(s.venue_address),1)):d("",!0),!s.city&&!s.country&&!s.location&&!s.venue_address?(n(),l("p",Kt,"â€”")):d("",!0)])]),e("td",Qt,[s.event_type?(n(),l("span",Xt,a(s.event_type),1)):(n(),l("span",Zt,"â€”"))]),e("td",te,[e("span",{class:Q(["px-2 py-1 rounded-full text-s font-semibold",s.status==="pagado"?"bg-green-500/20 text-green-300":s.status==="confirmado"?"bg-blue-500/20 text-blue-300":s.status==="pospuesto"?"bg-orange-500/20 text-orange-300":s.status==="cancelado"?"bg-red-500/20 text-red-300":"bg-yellow-500/20 text-yellow-300"])},a(s.status||"Sin estado"),3)]),x.value?(n(),l("td",ee,[e("div",se,[s.show_fee_total?(n(),l("p",oe,a(s.currency||"USD")+" "+a(Number(s.show_fee_total).toFixed(2)),1)):(n(),l("p",ae,"â€”"))])])):d("",!0),x.value?(n(),l("td",ne,[e("span",le,a(s.advance_percentage??50)+"%",1)])):d("",!0),w.value?(n(),l("td",re,a(s.full_payment_due_date?new Date(s.full_payment_due_date).toLocaleDateString("es-ES"):"â€”"),1)):d("",!0),e("td",de,a(((r=s.main_artist)==null?void 0:r.name)||((u=s.mainArtist)==null?void 0:u.name)||"-"),1),e("td",ie,[N.value?(n(),P(M(z),{key:0,href:o.route("admin.events.edit",s.id),class:"text-[#ffa236] hover:underline text-sm"},{default:F(()=>[...t[28]||(t[28]=[I(" Editar ",-1)])]),_:1},8,["href"])):d("",!0),w.value?(n(),P(M(z),{key:1,href:o.route("admin.events.finance",s.id),class:"text-green-400 hover:underline text-sm"},{default:F(()=>[...t[29]||(t[29]=[I(" Finanzas ",-1)])]),_:1},8,["href"])):d("",!0),N.value?(n(),l("button",{key:2,type:"button",class:"text-red-400 hover:underline text-sm",onClick:X(m=>J(s.id),["prevent"])}," Eliminar ",8,ue)):d("",!0)])])}),128))])])])]),_:1}))}},ge=et(ce,[["__scopeId","data-v-84cc9e1f"]]);export{ge as default};
